#! /usr/bin/env bash
set -e

prog=$0
error() {
   echo "Whoops!  Looks like $1:$2 failed."
   echo "Please try rerunning $prog again."
   exit 1
}
trap 'error "${BASH_SOURCE}" "${LINENO}"' ERR

SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" 
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

if [[ "$1" == "-t" ]]; then
  dest=$(mktemp)
else
  dest="$1"
fi

shift
if [[ -z "$dest" ]]; then
  echo "usage: $0 <dest | -t> [<cmd> <args>...]" 1>&2
  exit 1
fi

tmp=$(mktemp)

$@ > $tmp
mv $tmp $dest
echo $dest
