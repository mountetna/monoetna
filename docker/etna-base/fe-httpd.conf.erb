<VirtualHost *:80>
  DocumentRoot /app/public

  ServerName <%= @app_name %>_app_fe

  # Disable TRACE and TRACK. This bit here prevents a certain kind of attack
  # which leaks info by repeatedly calling these two methods.
  RewriteEngine On
  RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
  RewriteRule .* - [F]

  # Max 5 minutes waiting on the proxy.  Maybe it should be lower?
  ProxyTimeout 300
  ProxyPreserveHost on
  ProxyPassReverse / http://<%= @app_name %>_app %>:3000/

  # Add the Service-Worker-Allowed header to make service workers simple to use.
  Header add Service-Worker-Allowed "/"

  <Directory /app/public>
      Allow from all
      <IfModule mod_negotiation.c>
        Options -MultiViews
      </IfModule>
      Require all granted
  </Directory>

  # Route any url that does not map to a public asset to the backend server.
  RewriteCond "/app/public/%{REQUEST_URI}" !-f
  IncludeOptional /usr/opt/httpd.conf.d/*.rewrite.include
  RewriteRule ^/(.*)$ http://<%= @app_name %>_app:3000/$1 [P]

  IncludeOptional /usr/opt/httpd.conf.d/*.addon.include
</VirtualHost>
