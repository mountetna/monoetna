
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"[{\"Id\":2,\"Name\":\"redis-ha\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/redis.yml\",\"Env\":[{\"name\":\"REDIS_PASSWORD\",\"value\":\"redis_password\"}],\"ResourceControl\":{\"Id\":3,\"ResourceId\":\"1_redis-ha\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/2\",\"CreationDate\":1629483058,\"CreatedBy\":\"etna\",\"UpdateDate\":1641577201,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/redis.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":4,\"Name\":\"edge\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/edge.yml\",\"Env\":[{\"name\":\"MAIN_CONF_ERB\",\"value\":\"main.conf.erb\"}],\"ResourceControl\":{\"Id\":7,\"ResourceId\":\"1_edge\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[{\"TeamId\":1,\"AccessLevel\":1}],\"Public\":false,\"AdministratorsOnly\":false,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/4\",\"CreationDate\":1629765680,\"CreatedBy\":\"etna\",\"UpdateDate\":1641333995,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/edge.yml\",\"Authentication\":null,\"ConfigHash\":\"14c58939ab6b51d3b377fcbb2b68ffaaa528088a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":7,\"Name\":\"agents\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/agents.yml\",\"Env\":[],\"ResourceControl\":{\"Id\":36,\"ResourceId\":\"1_agents\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/7\",\"CreationDate\":1630378503,\"CreatedBy\":\"etna\",\"UpdateDate\":1641599251,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":null,\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/agents.yml\",\"Authentication\":null,\"ConfigHash\":\"6d09a4082adb027ef6389e65215608f34b691e5a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":12,\"Name\":\"monitor\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/monitor.yml\",\"Env\":[{\"name\":\"PROMETHEUS_CONFIG\",\"value\":\"prometheus.yml\"},{\"name\":\"ALERTS_CONFIG\",\"value\":\"alertmanager.yml\"},{\"name\":\"RULES_CONFIG\",\"value\":\"rules.yml\"},{\"name\":\"WEB_CONFIG\",\"value\":\"web-config.yml\"}],\"ResourceControl\":{\"Id\":49,\"ResourceId\":\"1_monitor\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/12\",\"CreationDate\":1630445964,\"CreatedBy\":\"etna\",\"UpdateDate\":1641604301,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/monitor.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":15,\"Name\":\"airflow\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/airflow.yml\",\"Env\":[{\"name\":\"_AIRFLOW_WWW_USER_USERNAME\",\"value\":\"etna\"},{\"name\":\"_AIRFLOW_WWW_USER_PASSWORD\",\"value\":\"etnapassword\"},{\"name\":\"AIRFLOW_FERNET_KEY\",\"value\":\"airflow-fernet-key\"}],\"ResourceControl\":{\"Id\":54,\"ResourceId\":\"1_airflow\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/15\",\"CreationDate\":1630648397,\"CreatedBy\":\"etna\",\"UpdateDate\":1641582516,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/airflow.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":17,\"Name\":\"vulcan\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/vulcan.yml\",\"Env\":[{\"name\":\"APP_CONFIG\",\"value\":\"vulcan.production.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.production.yml\"},{\"name\":\"BROWSER_SYSTEM_INCLUDE\",\"value\":\"browser.system.include\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"ROLLBAR_ACCESS_TOKEN\",\"value\":\"vulcan-rollbar-token\"}],\"ResourceControl\":{\"Id\":59,\"ResourceId\":\"1_vulcan\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/17\",\"CreationDate\":1630827434,\"CreatedBy\":\"etna\",\"UpdateDate\":1641605301,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/vulcan.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":28,\"Name\":\"janus-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/janus-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"janus\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_ENV\",\"value\":\"JANUS_ENV\"},{\"name\":\"APP_CONFIG\",\"value\":\"janus.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":83,\"ResourceId\":\"1_janus-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/28\",\"CreationDate\":1638227821,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598487,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/janus-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":30,\"Name\":\"polyphemus-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/polyphemus-staging.yml\",\"Env\":[{\"name\":\"APP_ENV\",\"value\":\"POLYPHEMUS_ENV\"},{\"name\":\"APP_NAME\",\"value\":\"polyphemus\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_CONFIG\",\"value\":\"polyphemus.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"},{\"name\":\"ID_RSA_GNE\",\"value\":\"id_rsa_gne\"}],\"ResourceControl\":{\"Id\":140,\"ResourceId\":\"1_polyphemus-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/30\",\"CreationDate\":1640813746,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598518,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/polyphemus-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"14c58939ab6b51d3b377fcbb2b68ffaaa528088a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":36,\"Name\":\"timur-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/timur-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"timur\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_ENV\",\"value\":\"TIMUR_ENV\"},{\"name\":\"APP_CONFIG\",\"value\":\"timur.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":210,\"ResourceId\":\"1_timur-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/36\",\"CreationDate\":1641252002,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598554,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/timur-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"c0b611a840bdf74165e6042683b3cc57f7c57a25\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":39,\"Name\":\"magma-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/magma-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"magma\"},{\"name\":\"APP_ENV\",\"value\":\"MAGMA_ENV\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_CONFIG\",\"value\":\"magma.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":241,\"ResourceId\":\"1_magma-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/39\",\"CreationDate\":1641343734,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598594,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/magma-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"343d405d96ebe9b9581163bcafed02a8f2f41d3c\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":42,\"Name\":\"metis-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/metis-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"metis\"},{\"name\":\"APP_ENV\",\"value\":\"METIS_ENV\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"DATA_SOURCE\",\"value\":\"/data3\"},{\"name\":\"APP_UID\",\"value\":\"1501\"},{\"name\":\"APP_CONFIG\",\"value\":\"metis.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"}],\"ResourceControl\":{\"Id\":244,\"ResourceId\":\"1_metis-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/42\",\"CreationDate\":1641348277,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598624,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/metis-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"797a79be3a0636b5f639a9afea362a79e0348b17\"},\"Namespace\":\"\",\"IsComposeFormat\":false}]","stderr":"","i":"1 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks/7","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"{\"Id\":7,\"Name\":\"agents\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/agents.yml\",\"Env\":[],\"ResourceControl\":{\"Id\":36,\"ResourceId\":\"1_agents\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/7\",\"CreationDate\":1630378503,\"CreatedBy\":\"etna\",\"UpdateDate\":1641599251,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":null,\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/agents.yml\",\"Authentication\":null,\"ConfigHash\":\"6d09a4082adb027ef6389e65215608f34b691e5a\"},\"Namespace\":\"\",\"IsComposeFormat\":false}","stderr":"","i":"2 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks/7/file","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"{\"StackFileContent\":\"version: '3.8'\\n\\n# Intended for agents that run in global deploy node, on most or all nodes, for service health purposes.\\nservices:\\n  swarm-keeper:\\n    image: etnaagent/swarm-keeper:production\\n    deploy:\\n      labels:\\n        - autoupdate=true\\n      mode: replicated\\n      replicas: 1\\n      placement:\\n        constraints: [node.role == manager]\\n      restart_policy:\\n        delay: 300s\\n    volumes:\\n      - /var/run/docker.sock:/var/run/docker.sock:ro\\n      - autodeployed:/deployed\\n    secrets:\\n      - source: git-swarm-keeper-private-key\\n        mode: 0400\\n      - portainer-auth.env\\n      - slack_webhook_url\\n      - service-deployer-docker-login\\n    command:\\n      - bash\\n      - -c\\n      - |\\n        set -eo pipefail\\n        source /usr/lib/swarm-keeper\\n        echo 'Login using /run/secrets/service-deployer-docker-login'\\n        docker login -u etnaagent -p \\\"$$(cat /run/secrets/service-deployer-docker-login)\\\"\\n        doPortainerAuth\\n        doGithubAuth\\n        # Run this for 5 hours before forcing a restart to refresh the portainer auth\\n        # Allows the caching to make things less more efficient\\n        for i in $$(seq 60); do\\n          checkAndDeployUpdatedImages\\n          # updateGitSources\\n          sleep 60\\n        done\\n  agent:\\n    image: gcr.io/cadvisor/cadvisor\\n    volumes:\\n      - /:/rootfs:ro\\n      - /var/run:/var/run:rw\\n      - /sys:/sys:ro\\n      - /var/lib/docker/:/var/lib/docker:ro\\n    deploy:\\n      mode: global\\n      placement:\\n        constraints: [node.platform.os == linux]\\n    ports:\\n      - 7100:8080\\n\\nvolumes:\\n  autodeployed:\\n\\nsecrets:\\n  slack_webhook_url:\\n    external: true\\n  service-deployer-docker-login:\\n    external: true\\n  git-swarm-keeper-private-key:\\n    external: true\\n  portainer-auth.env:\\n    external: true\"}","stderr":"","i":"3 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"[{\"Id\":2,\"Name\":\"redis-ha\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/redis.yml\",\"Env\":[{\"name\":\"REDIS_PASSWORD\",\"value\":\"redis_password\"}],\"ResourceControl\":{\"Id\":3,\"ResourceId\":\"1_redis-ha\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/2\",\"CreationDate\":1629483058,\"CreatedBy\":\"etna\",\"UpdateDate\":1641577201,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/redis.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":4,\"Name\":\"edge\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/edge.yml\",\"Env\":[{\"name\":\"MAIN_CONF_ERB\",\"value\":\"main.conf.erb\"}],\"ResourceControl\":{\"Id\":7,\"ResourceId\":\"1_edge\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[{\"TeamId\":1,\"AccessLevel\":1}],\"Public\":false,\"AdministratorsOnly\":false,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/4\",\"CreationDate\":1629765680,\"CreatedBy\":\"etna\",\"UpdateDate\":1641333995,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/edge.yml\",\"Authentication\":null,\"ConfigHash\":\"14c58939ab6b51d3b377fcbb2b68ffaaa528088a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":7,\"Name\":\"agents\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/agents.yml\",\"Env\":[],\"ResourceControl\":{\"Id\":36,\"ResourceId\":\"1_agents\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/7\",\"CreationDate\":1630378503,\"CreatedBy\":\"etna\",\"UpdateDate\":1641599251,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":null,\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/agents.yml\",\"Authentication\":null,\"ConfigHash\":\"6d09a4082adb027ef6389e65215608f34b691e5a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":12,\"Name\":\"monitor\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/monitor.yml\",\"Env\":[{\"name\":\"PROMETHEUS_CONFIG\",\"value\":\"prometheus.yml\"},{\"name\":\"ALERTS_CONFIG\",\"value\":\"alertmanager.yml\"},{\"name\":\"RULES_CONFIG\",\"value\":\"rules.yml\"},{\"name\":\"WEB_CONFIG\",\"value\":\"web-config.yml\"}],\"ResourceControl\":{\"Id\":49,\"ResourceId\":\"1_monitor\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/12\",\"CreationDate\":1630445964,\"CreatedBy\":\"etna\",\"UpdateDate\":1641604301,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/monitor.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":15,\"Name\":\"airflow\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/airflow.yml\",\"Env\":[{\"name\":\"_AIRFLOW_WWW_USER_USERNAME\",\"value\":\"etna\"},{\"name\":\"_AIRFLOW_WWW_USER_PASSWORD\",\"value\":\"etnapassword\"},{\"name\":\"AIRFLOW_FERNET_KEY\",\"value\":\"airflow-fernet-key\"}],\"ResourceControl\":{\"Id\":54,\"ResourceId\":\"1_airflow\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/15\",\"CreationDate\":1630648397,\"CreatedBy\":\"etna\",\"UpdateDate\":1641582516,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/airflow.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":17,\"Name\":\"vulcan\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/vulcan.yml\",\"Env\":[{\"name\":\"APP_CONFIG\",\"value\":\"vulcan.production.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.production.yml\"},{\"name\":\"BROWSER_SYSTEM_INCLUDE\",\"value\":\"browser.system.include\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"ROLLBAR_ACCESS_TOKEN\",\"value\":\"vulcan-rollbar-token\"}],\"ResourceControl\":{\"Id\":59,\"ResourceId\":\"1_vulcan\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/17\",\"CreationDate\":1630827434,\"CreatedBy\":\"etna\",\"UpdateDate\":1641605301,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/vulcan.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":28,\"Name\":\"janus-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/janus-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"janus\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_ENV\",\"value\":\"JANUS_ENV\"},{\"name\":\"APP_CONFIG\",\"value\":\"janus.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":83,\"ResourceId\":\"1_janus-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/28\",\"CreationDate\":1638227821,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598487,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/janus-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":30,\"Name\":\"polyphemus-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/polyphemus-staging.yml\",\"Env\":[{\"name\":\"APP_ENV\",\"value\":\"POLYPHEMUS_ENV\"},{\"name\":\"APP_NAME\",\"value\":\"polyphemus\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_CONFIG\",\"value\":\"polyphemus.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"},{\"name\":\"ID_RSA_GNE\",\"value\":\"id_rsa_gne\"}],\"ResourceControl\":{\"Id\":140,\"ResourceId\":\"1_polyphemus-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/30\",\"CreationDate\":1640813746,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598518,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/polyphemus-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"14c58939ab6b51d3b377fcbb2b68ffaaa528088a\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":36,\"Name\":\"timur-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/timur-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"timur\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_ENV\",\"value\":\"TIMUR_ENV\"},{\"name\":\"APP_CONFIG\",\"value\":\"timur.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":210,\"ResourceId\":\"1_timur-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/36\",\"CreationDate\":1641252002,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598554,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/timur-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"c0b611a840bdf74165e6042683b3cc57f7c57a25\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":39,\"Name\":\"magma-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/magma-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"magma\"},{\"name\":\"APP_ENV\",\"value\":\"MAGMA_ENV\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"APP_CONFIG\",\"value\":\"magma.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"}],\"ResourceControl\":{\"Id\":241,\"ResourceId\":\"1_magma-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/39\",\"CreationDate\":1641343734,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598594,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/magma-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"343d405d96ebe9b9581163bcafed02a8f2f41d3c\"},\"Namespace\":\"\",\"IsComposeFormat\":false},{\"Id\":42,\"Name\":\"metis-staging\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/metis-staging.yml\",\"Env\":[{\"name\":\"APP_NAME\",\"value\":\"metis\"},{\"name\":\"APP_ENV\",\"value\":\"METIS_ENV\"},{\"name\":\"ENV\",\"value\":\"staging\"},{\"name\":\"DATA_SOURCE\",\"value\":\"/data3\"},{\"name\":\"APP_UID\",\"value\":\"1501\"},{\"name\":\"APP_CONFIG\",\"value\":\"metis.staging.yml\"},{\"name\":\"ENV_CONFIG\",\"value\":\"etna.staging.yml\"},{\"name\":\"USER_HASH_SECRET\",\"value\":\"user-hash-secret\"},{\"name\":\"METRICS_PW\",\"value\":\"metrics-pw\"},{\"name\":\"STAGING_MAGMA_HMAC\",\"value\":\"staging-magma-hmac\"},{\"name\":\"STAGING_METIS_HMAC\",\"value\":\"staging-metis-hmac\"}],\"ResourceControl\":{\"Id\":244,\"ResourceId\":\"1_metis-staging\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/42\",\"CreationDate\":1641348277,\"CreatedBy\":\"etna\",\"UpdateDate\":1641598624,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":[],\"AutoUpdate\":{\"Interval\":\"\",\"Webhook\":\"\",\"JobID\":\"\"},\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/metis-staging.yml\",\"Authentication\":null,\"ConfigHash\":\"797a79be3a0636b5f639a9afea362a79e0348b17\"},\"Namespace\":\"\",\"IsComposeFormat\":false}]","stderr":"","i":"4 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks/7","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"{\"Id\":7,\"Name\":\"agents\",\"Type\":1,\"EndpointId\":1,\"SwarmId\":\"npcpmkzm9t2zp6gfq9o96wogc\",\"EntryPoint\":\"swarm/agents.yml\",\"Env\":[],\"ResourceControl\":{\"Id\":36,\"ResourceId\":\"1_agents\",\"SubResourceIds\":[],\"Type\":6,\"UserAccesses\":[],\"TeamAccesses\":[],\"Public\":false,\"AdministratorsOnly\":true,\"System\":false},\"Status\":1,\"ProjectPath\":\"/data/compose/7\",\"CreationDate\":1630378503,\"CreatedBy\":\"etna\",\"UpdateDate\":1641599251,\"UpdatedBy\":\"etna\",\"AdditionalFiles\":null,\"AutoUpdate\":null,\"GitConfig\":{\"URL\":\"https://github.com/mountetna/monoetna.git\",\"ReferenceName\":\"refs/heads/swarm/stacks\",\"ConfigFilePath\":\"swarm/agents.yml\",\"Authentication\":null,\"ConfigHash\":\"6d09a4082adb027ef6389e65215608f34b691e5a\"},\"Namespace\":\"\",\"IsComposeFormat\":false}","stderr":"","i":"5 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
{"cmd":"http","args":["--check-status","--proxy=http:socks5h://127.0.0.1:9090","--proxy=https:socks5h://127.0.0.1:9090","GET","https://portainer.dsco.ucsf.edu/api/stacks/7/file","Authorization: Bearer xxx"],"result":"0","stdin":"","stdout":"{\"StackFileContent\":\"version: '3.8'\\n\\n# Intended for agents that run in global deploy node, on most or all nodes, for service health purposes.\\nservices:\\n  swarm-keeper:\\n    image: etnaagent/swarm-keeper:production\\n    deploy:\\n      labels:\\n        - autoupdate=true\\n      mode: replicated\\n      replicas: 1\\n      placement:\\n        constraints: [node.role == manager]\\n      restart_policy:\\n        delay: 300s\\n    volumes:\\n      - /var/run/docker.sock:/var/run/docker.sock:ro\\n      - autodeployed:/deployed\\n    secrets:\\n      - source: git-swarm-keeper-private-key\\n        mode: 0400\\n      - portainer-auth.env\\n      - slack_webhook_url\\n      - service-deployer-docker-login\\n    command:\\n      - bash\\n      - -c\\n      - |\\n        set -eo pipefail\\n        source /usr/lib/swarm-keeper\\n        echo 'Login using /run/secrets/service-deployer-docker-login'\\n        docker login -u etnaagent -p \\\"$$(cat /run/secrets/service-deployer-docker-login)\\\"\\n        doPortainerAuth\\n        doGithubAuth\\n        # Run this for 5 hours before forcing a restart to refresh the portainer auth\\n        # Allows the caching to make things less more efficient\\n        for i in $$(seq 60); do\\n          checkAndDeployUpdatedImages\\n          # updateGitSources\\n          sleep 60\\n        done\\n  agent:\\n    image: gcr.io/cadvisor/cadvisor\\n    volumes:\\n      - /:/rootfs:ro\\n      - /var/run:/var/run:rw\\n      - /sys:/sys:ro\\n      - /var/lib/docker/:/var/lib/docker:ro\\n    deploy:\\n      mode: global\\n      placement:\\n        constraints: [node.platform.os == linux]\\n    ports:\\n      - 7100:8080\\n\\nvolumes:\\n  autodeployed:\\n\\nsecrets:\\n  slack_webhook_url:\\n    external: true\\n  service-deployer-docker-login:\\n    external: true\\n  git-swarm-keeper-private-key:\\n    external: true\\n  portainer-auth.env:\\n    external: true\"}","stderr":"","i":"6 /home/home/monoetna/swarm/swarm-keeper/lib/deploy-stack.recording"}
