---
driver:
  name: docker

provisioner:
  name: chef_zero
  always_update_cookbooks: true

platforms:
  - name: centos-7
    driver_config:
      image: test-centos
      platform: centos
      mount:
        - type=bind,source=/sys/fs/cgroup,target=/sys/fs/cgroup,ro
        - type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock
      run_command: /usr/sbin/init
      privileged: true
#      cap_add:
#        - SYS_ADMIN
#        - SYSLOG
#        - NET_ADMIN
      run_options:
        env: container=docker
      provision_command:
        - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
        - systemctl enable sshd.service
        - mkdir -p /run/systemd
        - echo 'docker' > /run/systemd/container
      use_internal_docker_network: true

transport:
  name: docker

verifier:
  name: inspec

suites:
  - name: default
    run_list:
      # Test idempotency by running all the things twice
      - recipe[base_v2::default]
      - recipe[etna_docker::default]
      - recipe[base_v2::default]
      - recipe[etna_docker::default]
    attributes:
      psql_developer_password: password
      docker:
        data_root: /usr/var/run/docker
